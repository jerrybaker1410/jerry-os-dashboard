import{j as e}from"./vendor-query-BDlgVFKC.js";import{r as j}from"./vendor-react-C3UgDDkQ.js";import{u as w}from"./useOpenRouterCosts-BiHYpYfO.js";import{G as D,u as T,k as $,f as d,b as O}from"./index-BLPMiw5x.js";import{P as R,B as A}from"./PageHeader-DXQHnwq5.js";import{C as r}from"./Badge-9NDiIoki.js";import{M as m}from"./MetricCard-Dry5Bpqx.js";import"./StatusBadge-x29XDuZr.js";import{C as M}from"./CopyButton-B9VrSSor.js";import{l as L,D as g,r as z,k as F}from"./vendor-icons-DvjlSrBB.js";import{R as y,A as G,C as b,X as N,Y as C,T as v,a as B,B as V,b as K}from"./vendor-charts-iqcW52cB.js";import"./vendor-dates-DKd7Sy4i.js";const u=["#3b82f6","#8b5cf6","#22c55e","#eab308","#ef4444","#ec4899"],k=({active:o,payload:a,label:i})=>!o||!a?.length?null:e.jsxs("div",{className:"bg-elevated border border-border-default rounded-md px-3 py-2 shadow-lg",children:[e.jsx("p",{className:"text-xs text-text-muted mb-1",children:i}),a.map((s,t)=>e.jsxs("p",{className:"text-sm font-data",style:{color:s.color},children:[s.name,": $",typeof s.value=="number"?s.value.toFixed(2):s.value]},t))]});function U({snapshots:o,range:a}){const s=(a==="7d"?o.slice(-7):a==="14d"?o.slice(-14):o).map(t=>({date:t.date,daily:t.cost?.usageDaily||0}));return s.length===0?e.jsxs(r,{children:[e.jsx("h3",{className:"text-sm font-medium text-text-primary mb-4",children:"Daily Spend"}),e.jsx("div",{className:"flex items-center justify-center h-60",children:e.jsxs("p",{className:"text-sm text-text-muted",children:["No history data. Run ",e.jsx("code",{className:"bg-elevated px-1 rounded",children:"history-logger.js"})," to populate charts."]})})]}):e.jsxs(r,{children:[e.jsx("h3",{className:"text-sm font-medium text-text-primary mb-4",children:"Daily Spend"}),e.jsx(y,{width:"100%",height:240,children:e.jsxs(G,{data:s,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"costGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:0})]})}),e.jsx(b,{strokeDasharray:"3 3",stroke:"#2a2a2a"}),e.jsx(N,{dataKey:"date",tick:{fill:"#666",fontSize:11},tickFormatter:t=>t.slice(5)}),e.jsx(C,{tick:{fill:"#666",fontSize:11},tickFormatter:t=>`$${t}`}),e.jsx(v,{content:e.jsx(k,{})}),e.jsx(B,{type:"monotone",dataKey:"daily",stroke:"#3b82f6",fill:"url(#costGradient)",strokeWidth:2,name:"Daily Cost"})]})})]})}function E({snapshots:o,range:a}){const s=(a==="7d"?o.slice(-7):a==="14d"?o.slice(-14):o).map(t=>({date:t.date,sessions:t.sessions?.total||0,cron:t.sessions?.cron||0,subagent:t.sessions?.subagent||0}));return s.length===0?null:e.jsxs(r,{children:[e.jsx("h3",{className:"text-sm font-medium text-text-primary mb-4",children:"Sessions Over Time"}),e.jsx(y,{width:"100%",height:240,children:e.jsxs(V,{data:s,children:[e.jsx(b,{strokeDasharray:"3 3",stroke:"#2a2a2a"}),e.jsx(N,{dataKey:"date",tick:{fill:"#666",fontSize:11},tickFormatter:t=>t.slice(5)}),e.jsx(C,{tick:{fill:"#666",fontSize:11}}),e.jsx(v,{content:e.jsx(k,{})}),e.jsx(K,{dataKey:"sessions",name:"Total Sessions",fill:"#3b82f6",radius:[4,4,0,0]})]})})]})}function H({sessions:o}){const a={};(o||[]).forEach(s=>{s.model&&(a[s.model]||(a[s.model]={name:s.model,sessions:0,tokens:0}),a[s.model].sessions+=1,a[s.model].tokens+=s.totalTokens||0)});const i=Object.values(a).sort((s,t)=>t.sessions-s.sessions);return i.length===0?e.jsxs(r,{children:[e.jsx("h3",{className:"text-sm font-medium text-text-primary mb-4",children:"Model Usage"}),e.jsx("p",{className:"text-sm text-text-muted text-center py-6",children:"No session data available"})]}):e.jsxs(r,{padding:"none",children:[e.jsx(r.Header,{title:"Model Usage (Current Sessions)"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border-default",children:[e.jsx("th",{className:"px-4 py-2.5 text-left text-xs font-medium text-text-muted uppercase",children:"Model"}),e.jsx("th",{className:"px-4 py-2.5 text-right text-xs font-medium text-text-muted uppercase",children:"Sessions"}),e.jsx("th",{className:"px-4 py-2.5 text-right text-xs font-medium text-text-muted uppercase",children:"Tokens"}),e.jsx("th",{className:"px-4 py-2.5 text-right text-xs font-medium text-text-muted uppercase",children:"% of Sessions"})]})}),e.jsx("tbody",{className:"divide-y divide-border-default",children:i.map((s,t)=>{const c=i.reduce((h,p)=>h+p.sessions,0),l=c>0?s.sessions/c*100:0;return e.jsxs("tr",{className:"hover:bg-elevated/50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:u[t%u.length]}}),e.jsx(M,{text:s.name})]})}),e.jsx("td",{className:"px-4 py-3 text-right text-sm text-text-secondary font-data",children:s.sessions}),e.jsx("td",{className:"px-4 py-3 text-right text-sm text-text-secondary font-data",children:O(s.tokens)}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("div",{className:"w-16 h-1.5 bg-elevated rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full",style:{width:`${l}%`,backgroundColor:u[t%u.length]}})}),e.jsxs("span",{className:"text-xs text-text-muted font-data w-10 text-right",children:[l.toFixed(1),"%"]})]})})]},t)})})]})})]})}function te(){const{gatewayConnected:o}=j.useContext(D),{data:a,isLoading:i,refetch:s}=w(),{data:t,isLoading:c}=T({sseConnected:o}),[l,h]=j.useState("30d");if(i||c)return e.jsx($,{});const n=a||{},S=t?.sessions||[],f=t?.historySnapshots||[];return e.jsxs("div",{className:"page-enter space-y-6",children:[e.jsx(R,{title:"Cost Analytics",subtitle:"OpenRouter spend tracking",onRefresh:s,actions:e.jsx("div",{className:"flex items-center gap-1 bg-surface border border-border-default rounded-md p-0.5",children:["7d","14d","30d"].map(x=>e.jsx(A,{variant:l===x?"primary":"ghost",size:"xs",onClick:()=>h(x),children:x},x))})}),!n.connected&&e.jsxs(r,{className:"border-yellow-500/30 flex items-center gap-3",children:[e.jsx(L,{size:18,className:"text-yellow-500 shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Connect OpenRouter"}),e.jsx("p",{className:"text-xs text-text-muted",children:"Add an OpenRouter API key to your OpenClaw config to see real cost data."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(m,{label:"This Month",value:n.connected?`$${d(n.usageMonthly)}`:"—",subValue:n.connected?"OpenRouter usage":"Not connected",icon:g,accentColor:"accent-blue"}),e.jsx(m,{label:"Today",value:n.connected?`$${d(n.usageDaily)}`:"—",subValue:"daily spend",icon:z,accentColor:"accent-green"}),e.jsx(m,{label:"This Week",value:n.connected?`$${d(n.usageWeekly)}`:"—",subValue:"weekly spend",icon:g,accentColor:"accent-yellow"}),e.jsx(m,{label:"All Time",value:n.connected?`$${d(n.usage)}`:"—",subValue:n.limit?`of $${d(n.limit)} limit`:"total usage",icon:F,accentColor:"accent-blue"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx(U,{snapshots:f,range:l}),e.jsx(E,{snapshots:f,range:l})]}),e.jsx(H,{sessions:S})]})}export{te as default};
