import{j as e}from"./vendor-query-BDlgVFKC.js";import{r as f,e as M}from"./vendor-react-C3UgDDkQ.js";import{u as T}from"./vendor-virtual-BChkfkd2.js";import{G as D,u as A,a as E,S as O,C as h,f as m,b as w,c as y,A as j,d as z,e as R}from"./index-BLPMiw5x.js";import{u as L}from"./useOpenRouterCosts-BiHYpYfO.js";import{P as _}from"./PageHeader-DXQHnwq5.js";import{M as b}from"./MetricCard-Dry5Bpqx.js";import{C as I}from"./CopyButton-B9VrSSor.js";import{A as g,Z as C,D as N,k as V,C as $,l as H,m as U,h as G,T as J,n as F}from"./vendor-icons-DvjlSrBB.js";import"./vendor-dates-DKd7Sy4i.js";function P({sessions:d,cronJobs:c,costData:o,activityData:a}){const t=d.filter(u=>u.ageMs!=null&&u.ageMs<6e5).length,n=o?.usageDaily||0,i=o?.connected;let r="bg-accent-green",l="text-accent-green";n>=h.critical?(r="bg-accent-red",l="text-accent-red"):n>=h.warning&&(r="bg-accent-yellow",l="text-accent-yellow");const s=i?Math.min(n/h.critical*100,100):0,x=a?.[0]?.time;return e.jsxs("div",{className:"bg-surface border border-border-default rounded-lg px-5 py-3 flex items-center gap-6 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-full bg-accent-green animate-pulse"}),e.jsx("span",{className:"text-xs text-text-secondary",children:"Gateway Live"})]}),e.jsx("div",{className:"w-px h-5 bg-border-default"}),e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-[180px] max-w-xs",children:[e.jsx("span",{className:"text-xs text-text-muted shrink-0",children:"Daily Spend"}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"h-2 bg-elevated rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all ${r}`,style:{width:`${s}%`}})})}),e.jsx("span",{className:`text-xs font-data font-semibold ${l}`,children:i?`$${m(n)}`:"—"}),e.jsxs("span",{className:"text-caption text-text-muted",children:["/ $",h.critical]})]}),e.jsx("div",{className:"w-px h-5 bg-border-default"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{size:13,className:"text-accent-green"}),e.jsxs("span",{className:"text-xs text-text-secondary",children:[e.jsx("span",{className:"font-semibold font-data text-text-primary",children:t})," active"]})]}),e.jsx("div",{className:"w-px h-5 bg-border-default"}),e.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[e.jsx($,{size:12,className:"text-text-muted"}),e.jsx("span",{className:"text-detail text-text-muted",children:x?y(x):"No recent activity"})]})]})}function B({sessions:d}){const c=M(),o=f.useMemo(()=>{const t=new Set;return d.forEach(n=>{const i=(n.key||"").split(":");i[1]&&t.add(i[1])}),t},[d]),a=f.useMemo(()=>{const t={};return Object.values(j).forEach(n=>{t[n.team]||(t[n.team]=[]),t[n.team].push(n)}),t},[]);return e.jsxs("div",{className:"bg-surface border border-border-default rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border-default",children:[e.jsx("h3",{className:"text-sm font-medium text-text-primary",children:"Fleet Status"}),e.jsx("button",{type:"button",onClick:()=>c("/agents"),className:"text-caption text-accent-blue hover:underline",children:"View All →"})]}),e.jsx("div",{className:"p-4 space-y-3",children:Object.entries(z).map(([t,n])=>{const i=a[n.id]||[];if(i.length===0)return null;const r=i.filter(s=>o.has(s.id)),l=i.length-r.length;return e.jsxs("div",{children:[e.jsx("p",{className:"text-caption text-text-muted mb-1.5",children:n.label}),e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[r.map(s=>e.jsxs("div",{className:"relative group cursor-default",title:`${s.name} — ${s.role} (active)`,children:[e.jsx("div",{className:"w-7 h-7 rounded-full flex items-center justify-center text-[8px] font-bold text-white border-2 border-accent-green shadow-[0_0_6px_rgba(34,197,94,0.4)] transition-colors",style:{backgroundColor:s.color},children:s.name.split(" ").map(x=>x[0]).join("").slice(0,2).toUpperCase()}),e.jsx("span",{className:"absolute -bottom-0.5 -right-0.5 w-2.5 h-2.5 rounded-full bg-accent-green border-2 border-surface animate-pulse"})]},s.id)),l>0&&e.jsxs("span",{className:"text-caption text-text-muted bg-elevated/50 px-2 py-0.5 rounded-full border border-border-default",title:i.filter(s=>!o.has(s.id)).map(s=>s.name).join(", "),children:["+",l," idle"]})]})]},t)})}),e.jsx("div",{className:"border-t border-border-default px-4 py-2",children:e.jsxs("span",{className:"text-caption text-text-muted",children:[o.size," of ",Object.keys(j).length," agents active"]})})]})}function W({activities:d}){const c={session:{icon:F,color:"text-accent-blue",border:"border-l-accent-blue"},subagent:{icon:J,color:"text-accent-green",border:"border-l-accent-green"},cron_run:{icon:C,color:"text-accent-yellow",border:"border-l-accent-yellow"},cron_complete:{icon:G,color:"text-accent-green",border:"border-l-accent-green"},cron_scheduled:{icon:U,color:"text-text-muted",border:"border-l-border-default"}};if(!d||d.length===0)return e.jsxs("div",{className:"bg-surface border border-border-default rounded-lg p-6 text-center",children:[e.jsx(g,{size:20,className:"mx-auto text-text-muted mb-2"}),e.jsx("p",{className:"text-sm text-text-muted",children:"No recent activity"})]});const o=Date.now(),a={"Last Hour":[],"Last 4 Hours":[],Today:[],Earlier:[]};d.forEach(r=>{const l=o-new Date(r.time).getTime();l<36e5?a["Last Hour"].push(r):l<144e5?a["Last 4 Hours"].push(r):l<864e5?a.Today.push(r):a.Earlier.push(r)});const t=f.useMemo(()=>{const r=[];return Object.entries(a).forEach(([l,s])=>{s.length!==0&&(r.push({type:"header",label:l,key:`header-${l}`}),s.forEach(x=>{r.push({type:"item",data:x,key:x.id})}))}),r},[a]),n=f.useRef(null),i=T({count:t.length,getScrollElement:()=>n.current,estimateSize:r=>t[r]?.type==="header"?28:56,overscan:8});return e.jsxs("div",{className:"bg-surface border border-border-default rounded-lg lg:col-span-2",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border-default",children:[e.jsx("h3",{className:"text-sm font-medium text-text-primary",children:"Activity Feed"}),e.jsxs("span",{className:"text-xs text-text-muted",children:[d.length," events"]})]}),e.jsx("div",{ref:n,className:"max-h-[400px] overflow-y-auto",children:e.jsx("div",{style:{height:`${i.getTotalSize()}px`,position:"relative"},children:i.getVirtualItems().map(r=>{const l=t[r.index];if(l.type==="header")return e.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${r.start}px)`},className:"px-4 py-1.5 bg-elevated/30",children:e.jsx("p",{className:"text-caption uppercase tracking-wider text-text-muted",children:l.label})},l.key);const s=l.data,x=c[s.type]||{icon:g,color:"text-text-muted",border:"border-l-border-default"},u=x.icon;return e.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${r.start}px)`},className:`flex items-start gap-3 px-4 py-3 hover:bg-elevated/50 transition-colors border-b border-border-default border-l-2 ${x.border}`,children:[e.jsx("span",{className:`mt-0.5 shrink-0 ${x.color}`,children:e.jsx(u,{size:14})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`text-sm leading-snug ${s.type==="cron_complete"||s.type==="session"?"text-text-primary font-medium":"text-text-secondary"}`,children:s.message}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-caption text-text-muted",children:s.agent}),e.jsx("span",{className:"text-caption text-text-muted",children:"·"}),e.jsx("span",{className:"text-caption text-text-muted",children:y(s.time)})]})]})]},l.key)})})})]})}function Y({snapshots:d}){const c=(d||[]).slice(-14);if(c.length===0)return e.jsxs("div",{className:"bg-surface border border-border-default rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-text-primary",children:"Daily Spend (14d)"}),e.jsx(N,{size:14,className:"text-text-muted"})]}),e.jsx("div",{className:"flex items-center justify-center h-20",children:e.jsx("p",{className:"text-xs text-text-muted",children:"No history data yet"})})]});const o=Math.max(...c.map(a=>a.cost?.usageDaily||0),.01);return e.jsxs("div",{className:"bg-surface border border-border-default rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-text-primary",children:"Daily Spend (14d)"}),e.jsx(N,{size:14,className:"text-text-muted"})]}),e.jsx("div",{className:"flex items-end gap-1 h-20",children:c.map((a,t)=>{const n=a.cost?.usageDaily||0,i=Math.max(n/o*100,4),r=t===c.length-1,l=n>=h.critical;return e.jsx("div",{className:"flex-1 flex flex-col items-center gap-1",title:`${a.date}: $${n.toFixed(2)}`,children:e.jsx("div",{className:`w-full rounded-sm transition-all ${l?"bg-accent-red":r?"bg-accent-blue":"bg-accent-blue/30"}`,style:{height:`${i}%`}})},t)})}),e.jsxs("div",{className:"flex justify-between mt-2",children:[e.jsx("span",{className:"text-caption text-text-muted",children:c[0]?.date?.slice(5)}),e.jsx("span",{className:"text-caption text-text-muted",children:"Today"})]})]})}function Z({cronJobs:d}){const c=(d||[]).filter(t=>t.enabled),o=c.filter(t=>t.state?.nextRunAtMs).sort((t,n)=>t.state.nextRunAtMs-n.state.nextRunAtMs).slice(0,5),a=t=>{const n=Object.values(j).find(i=>i.id===t);return n?`${n.emoji} ${n.name}`:t||"system"};return e.jsxs("div",{className:"bg-surface border border-border-default rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border-default",children:[e.jsx("h3",{className:"text-sm font-medium text-text-primary",children:"Upcoming Cron Jobs"}),e.jsxs("span",{className:"text-xs text-text-muted",children:[c.length," active"]})]}),o.length===0?e.jsx("div",{className:"p-6 text-center text-text-muted text-sm",children:"No upcoming jobs"}):e.jsx("div",{className:"divide-y divide-border-default",children:o.map(t=>e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3",children:[e.jsx($,{size:14,className:"text-accent-yellow shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-text-primary truncate",children:t.name}),e.jsx("p",{className:"text-xs text-text-muted",children:a(t.agentId)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-text-secondary font-data",children:y(new Date(t.state.nextRunAtMs).toISOString())}),e.jsx("p",{className:"text-caption text-text-muted",children:R(t.schedule?.expr)})]})]},t.id))})]})}function q(){return e.jsxs("div",{className:"bg-surface border border-yellow-500/30 rounded-lg p-4 flex items-center gap-3",children:[e.jsx(H,{size:18,className:"text-yellow-500 shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Connect OpenRouter"}),e.jsx("p",{className:"text-xs text-text-muted",children:"Add an OpenRouter API key to your OpenClaw config to see real cost data."})]})]})}function K({sessions:d}){const c={};(d||[]).forEach(a=>{a.model&&(c[a.model]||(c[a.model]={sessions:0,tokens:0}),c[a.model].sessions+=1,c[a.model].tokens+=a.totalTokens||0)});const o=Object.entries(c).map(([a,t])=>({name:a,...t})).sort((a,t)=>t.sessions-a.sessions);return o.length===0?null:e.jsxs("div",{className:"bg-surface border border-border-default rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-text-primary mb-3",children:"Models in Use"}),e.jsx("div",{className:"space-y-2",children:o.map(a=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(I,{text:a.name,className:"flex-1 truncate"}),e.jsxs("span",{className:"text-xs text-text-muted font-data ml-2",children:[a.sessions," sess"]}),e.jsx("span",{className:"text-xs text-text-muted font-data ml-2",children:w(a.tokens)})]},a.name))})]})}function ie(){const{gatewayConnected:d}=f.useContext(D),{data:c,isLoading:o,error:a,refetch:t}=A({sseConnected:d}),{data:n}=L(),{data:i}=E({sseConnected:d});if(o)return e.jsx(O,{});if(a)return e.jsxs("div",{className:"text-accent-red p-4",children:["Error loading dashboard: ",a.message]});const r=c?.sessions||[],l=c?.cronJobs||[],s=n||c?.openrouterUsage||{},x=c?.historySnapshots||[],u=r.filter(p=>p.ageMs!=null&&p.ageMs<6e5).length,k=r.reduce((p,S)=>p+(S.totalTokens||0),0),v=l.filter(p=>p.enabled).length;return e.jsxs("div",{className:"page-enter space-y-6",children:[e.jsx(_,{title:"Command Center",subtitle:"Real-time operations overview",onRefresh:t}),e.jsx(P,{sessions:r,cronJobs:l,costData:s,activityData:i}),!s?.connected&&e.jsx(q,{}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(b,{label:"Active Sessions",value:u,subValue:`${r.length} total`,trend:u>0?"up":"neutral",icon:g,accentColor:"accent-green"}),e.jsx(b,{label:"Cron Jobs",value:v,subValue:`${l.length} total`,trend:v>0?"up":"neutral",icon:C,accentColor:"accent-blue"}),e.jsx(b,{label:"Daily Spend",value:s?.connected?`$${m(s.usageDaily)}`:"—",subValue:s?.connected?`$${h.critical} budget`:"Not connected",icon:N,accentColor:"accent-yellow"}),e.jsx(b,{label:"Total Tokens",value:w(k),subValue:"across all sessions",icon:V,accentColor:"accent-blue"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsx(W,{activities:i||[]}),e.jsx(B,{sessions:r})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsx(Z,{cronJobs:l}),e.jsx(Y,{snapshots:x}),e.jsxs("div",{className:"space-y-4",children:[s?.connected&&e.jsxs("div",{className:"bg-surface border border-border-default rounded-lg p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("h3",{className:"text-sm font-medium text-text-primary",children:"OpenRouter Usage"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs text-text-muted",children:"Total"}),e.jsxs("span",{className:"text-sm font-semibold text-text-primary font-data",children:["$",m(s.usage)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs text-text-muted",children:"Monthly"}),e.jsxs("span",{className:"text-sm text-text-secondary font-data",children:["$",m(s.usageMonthly)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs text-text-muted",children:"Weekly"}),e.jsxs("span",{className:"text-sm text-text-secondary font-data",children:["$",m(s.usageWeekly)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs text-text-muted",children:"Today"}),e.jsxs("span",{className:"text-sm text-text-secondary font-data",children:["$",m(s.usageDaily)]})]})]}),s.limit!=null&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"h-2 bg-elevated rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-accent-blue rounded-full transition-all",style:{width:`${Math.min((s.usage||0)/(s.limit||1)*100,100)}%`}})}),e.jsxs("p",{className:"text-caption text-text-muted mt-1",children:["$",m(s.usage)," / $",m(s.limit)]})]})]}),e.jsx(K,{sessions:r})]})]})]})}export{ie as default};
