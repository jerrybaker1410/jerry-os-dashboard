import{j as e}from"./vendor-query-BDlgVFKC.js";import{r as p}from"./vendor-react-C3UgDDkQ.js";import{G as T,m as O,A as w,d as h,h as $,b as v,r as z}from"./index-BLPMiw5x.js";import{P as E}from"./PageHeader-DXQHnwq5.js";import{E as G}from"./EmptyState-BRa_Xz5S.js";import{C as k}from"./CopyButton-B9VrSSor.js";import{i as L,N as P,s as D,U as I,d as R,A as V,Z as F,C as U,X as Z}from"./vendor-icons-DvjlSrBB.js";import"./vendor-dates-DKd7Sy4i.js";function q({agent:n,sessions:m,onClose:s}){if(!n)return null;const i=Object.values(h).find(t=>t.id===n.team),a=m.filter(t=>(t.key||"").split(":")[1]===n.id),o=a.filter(t=>t.ageMs!=null&&t.ageMs<6e5),c=a.reduce((t,l)=>t+(l.totalTokens||0),0),x={};return a.forEach(t=>{t.model&&(x[t.model]=(x[t.model]||0)+1)}),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/40 z-40",onClick:s}),e.jsxs("div",{className:"fixed top-0 right-0 h-screen w-full max-w-md bg-surface border-l border-border-default z-50 overflow-y-auto animate-slide-in-right",children:[e.jsxs("div",{className:"sticky top-0 bg-surface border-b border-border-default px-5 py-4 flex items-center gap-3 z-10",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center text-xl shrink-0",style:{backgroundColor:`${n.color}15`},children:n.emoji}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h2",{className:"text-base font-semibold text-text-primary truncate",children:n.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-text-muted",children:n.role}),i&&e.jsx("span",{className:"text-micro px-1.5 py-0.5 rounded-full font-medium",style:{backgroundColor:`${i.color}15`,color:i.color},children:i.label})]})]}),e.jsx("button",{type:"button",onClick:s,className:"p-2 rounded-md hover:bg-elevated text-text-muted hover:text-text-primary transition-colors",children:e.jsx(Z,{size:16})})]}),e.jsxs("div",{className:"p-5 space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-elevated/50 rounded-lg p-3 text-center",children:[e.jsx("p",{className:"text-lg font-semibold font-data text-text-primary",children:a.length}),e.jsx("p",{className:"text-caption text-text-muted",children:"Total Sessions"})]}),e.jsxs("div",{className:"bg-elevated/50 rounded-lg p-3 text-center",children:[e.jsx("p",{className:"text-lg font-semibold font-data text-accent-green",children:o.length}),e.jsx("p",{className:"text-caption text-text-muted",children:"Active Now"})]}),e.jsxs("div",{className:"bg-elevated/50 rounded-lg p-3 text-center",children:[e.jsx("p",{className:"text-lg font-semibold font-data text-text-primary",children:v(c)}),e.jsx("p",{className:"text-caption text-text-muted",children:"Total Tokens"})]}),e.jsxs("div",{className:"bg-elevated/50 rounded-lg p-3 text-center",children:[e.jsx("p",{className:"text-lg font-semibold font-data text-text-primary",children:Object.keys(x).length}),e.jsx("p",{className:"text-caption text-text-muted",children:"Models Used"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-caption uppercase tracking-wider text-text-muted mb-2",children:"Identity"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs text-text-muted",children:"Agent ID"}),e.jsx(k,{text:n.id})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs text-text-muted",children:"Team"}),e.jsx("span",{className:"text-xs text-text-secondary",children:i?.label||"Unknown"})]})]})]}),Object.keys(x).length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-caption uppercase tracking-wider text-text-muted mb-2",children:"Models"}),e.jsx("div",{className:"space-y-1.5",children:Object.entries(x).sort(([,t],[,l])=>l-t).map(([t,l])=>e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsx(k,{text:t,className:"flex-1 truncate"}),e.jsxs("span",{className:"text-xs text-text-muted font-data ml-2",children:[l," sess"]})]},t))})]}),a.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-caption uppercase tracking-wider text-text-muted mb-2",children:"Recent Sessions"}),e.jsx("div",{className:"space-y-1",children:a.slice(0,10).map((t,l)=>{const j=(t.key||"").split(":")[2]||"unknown",f=t.ageMs!=null&&t.ageMs<6e5;return e.jsxs("div",{className:"flex items-center gap-2 py-1.5 px-2 rounded hover:bg-elevated/50",children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full shrink-0 ${f?"bg-accent-green animate-pulse":"bg-gray-600"}`}),e.jsx("span",{className:"text-xs text-text-secondary flex-1 truncate",children:j}),e.jsx("span",{className:"text-caption text-text-muted font-data",children:t.model?.split("/").pop()||"—"}),e.jsx("span",{className:"text-caption text-text-muted font-data",children:t.totalTokens?v(t.totalTokens):"—"})]},l)})})]})]})]})]})}function H({agents:n,sessions:m,onSelectAgent:s}){const i=p.useMemo(()=>{const o={};return n.forEach(c=>{o[c.team]||(o[c.team]=[]),o[c.team].push(c)}),o},[n]),a=n.find(o=>o.id==="main");return e.jsxs("div",{className:"space-y-6",children:[a&&e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{type:"button",onClick:()=>s(a),className:"bg-surface border-2 border-accent-blue/30 rounded-xl px-6 py-4 hover:border-accent-blue transition-colors group",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:a.emoji}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-sm font-semibold text-text-primary group-hover:text-accent-blue transition-colors",children:a.name}),e.jsx("p",{className:"text-caption text-text-muted",children:a.role})]}),e.jsxs("div",{className:"ml-3 flex items-center gap-1",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${a.activeSessions>0?"bg-accent-green animate-pulse":"bg-gray-600"}`}),e.jsxs("span",{className:"text-caption text-text-muted font-data",children:[a.sessionCount," sess"]})]})]})})}),e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"w-px h-6 bg-border-default"})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:Object.entries(h).map(([o,c])=>{const x=i[c.id]||[];if(x.length===0)return null;const t=c.id==="core"?x.filter(l=>l.id!=="main"):x;return t.length===0?null:e.jsxs("div",{className:"bg-surface border border-border-default rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"px-3 py-2 border-b border-border-default flex items-center gap-2",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-full",style:{backgroundColor:c.color}}),e.jsx("span",{className:"text-xs font-medium text-text-primary",children:c.label}),e.jsx("span",{className:"text-caption text-text-muted ml-auto font-data",children:t.length})]}),e.jsx("div",{className:"divide-y divide-border-default",children:t.map(l=>e.jsxs("button",{type:"button",onClick:()=>s(l),className:"w-full flex items-center gap-2.5 px-3 py-2.5 hover:bg-elevated/50 transition-colors text-left group",children:[e.jsx("span",{className:"text-base",children:l.emoji}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-medium text-text-primary group-hover:text-accent-blue transition-colors truncate",children:l.name}),e.jsx("p",{className:"text-micro text-text-muted truncate",children:l.role})]}),e.jsxs("div",{className:"flex items-center gap-1.5 shrink-0",children:[l.activeSessions>0&&e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-accent-green animate-pulse"}),e.jsx("span",{className:"text-caption text-text-muted font-data",children:l.sessionCount}),e.jsx(R,{size:10,className:"text-text-muted opacity-0 group-hover:opacity-100 transition-opacity"})]})]},l.id))})]},o)})})]})}function X({agents:n,onSelectAgent:m}){return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:n.map(s=>{const i=Object.values(h).find(o=>o.id===s.team),a=s.activeSessions>0;return e.jsxs("button",{type:"button",onClick:()=>m(s),className:"bg-surface border border-border-default rounded-lg p-5 hover:border-border-hover transition-all text-left group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center text-lg",style:{backgroundColor:`${s.color}15`},children:s.emoji}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-text-primary group-hover:text-accent-blue transition-colors",children:s.name}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-0.5",children:[e.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${a?"bg-accent-green animate-pulse-green":"bg-gray-600"}`}),e.jsx("span",{className:"text-caption text-text-muted",children:s.role})]})]})]}),i&&e.jsx("span",{className:"text-micro px-1.5 py-0.5 rounded-full font-medium",style:{backgroundColor:`${i.color}15`,color:i.color},children:i.label})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"bg-elevated rounded-md px-2 py-2 text-center",children:[e.jsx(V,{size:12,className:"text-text-muted mx-auto mb-1"}),e.jsx("div",{className:"text-xs font-semibold text-text-primary",children:s.sessionCount}),e.jsx("div",{className:"text-micro text-text-muted",children:"Sessions"})]}),e.jsxs("div",{className:"bg-elevated rounded-md px-2 py-2 text-center",children:[e.jsx(F,{size:12,className:"text-text-muted mx-auto mb-1"}),e.jsx("div",{className:"text-xs font-semibold text-text-primary",children:v(s.totalTokens)}),e.jsx("div",{className:"text-micro text-text-muted",children:"Tokens"})]}),e.jsxs("div",{className:"bg-elevated rounded-md px-2 py-2 text-center",children:[e.jsx(U,{size:12,className:"text-text-muted mx-auto mb-1"}),e.jsx("div",{className:"text-xs font-semibold text-text-primary",children:s.lastActiveMs!==null&&s.lastActiveMs!==1/0?s.lastActiveMs<6e4?"Now":z(new Date(Date.now()-s.lastActiveMs).toISOString()):"—"}),e.jsx("div",{className:"text-micro text-text-muted",children:"Last Active"})]})]})]},s.id)})})}function te(){const{gatewayConnected:n}=p.useContext(T),{data:m=[],isLoading:s,refetch:i}=O({sseConnected:n}),[a,o]=p.useState(""),[c,x]=p.useState("all"),[t,l]=p.useState("org"),[N,j]=p.useState(null),f=p.useMemo(()=>Object.values(w).map(r=>{const d=m.filter(u=>(u.key||"").split(":")[1]===r.id),b=d.reduce((u,y)=>u+(y.totalTokens||0),0),A=d.filter(u=>u.ageMs!=null&&u.ageMs<6e5),M=d.length>0?Math.min(...d.map(u=>u.ageMs??1/0)):null;return{...r,sessionCount:d.length,activeSessions:A.length,totalTokens:b,lastActiveMs:M}}),[m]),g=p.useMemo(()=>{let r=f;if(c!=="all"&&(r=r.filter(d=>d.team===c)),a.trim()){const d=a.toLowerCase();r=r.filter(b=>b.name.toLowerCase().includes(d)||b.role.toLowerCase().includes(d)||b.id.toLowerCase().includes(d))}return r},[f,c,a]),C=["all",...Object.values(h).map(r=>r.id)],S=r=>r==="all"?"All":h[Object.keys(h).find(d=>h[d].id===r)]?.label||r;return e.jsxs("div",{className:"page-enter space-y-4",children:[e.jsx(E,{title:"Agent Fleet",subtitle:`${Object.keys(w).length} agents across ${Object.keys(h).length} teams`,onRefresh:i}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(L,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"}),e.jsx("input",{type:"text",value:a,onChange:r=>o(r.target.value),placeholder:"Search agents...",className:"w-full pl-9 pr-3 py-2 bg-surface border border-border-default rounded-md text-sm text-text-primary placeholder:text-text-muted focus:outline-none focus:border-accent-blue transition-colors","aria-label":"Search agents"})]}),e.jsx("div",{className:"flex items-center gap-1 bg-surface border border-border-default rounded-md p-0.5 overflow-x-auto",children:C.map(r=>e.jsx("button",{type:"button",onClick:()=>x(r),className:`px-2.5 py-1.5 rounded text-xs font-medium transition-colors whitespace-nowrap ${c===r?"bg-accent-blue/10 text-accent-blue":"text-text-muted hover:text-text-secondary"}`,children:S(r)},r))}),e.jsxs("div",{className:"flex items-center gap-0.5 bg-surface border border-border-default rounded-md p-0.5",children:[e.jsx("button",{type:"button",onClick:()=>l("org"),className:`p-1.5 rounded transition-colors ${t==="org"?"bg-accent-blue/10 text-accent-blue":"text-text-muted hover:text-text-secondary"}`,title:"Org Chart",children:e.jsx(P,{size:14})}),e.jsx("button",{type:"button",onClick:()=>l("grid"),className:`p-1.5 rounded transition-colors ${t==="grid"?"bg-accent-blue/10 text-accent-blue":"text-text-muted hover:text-text-secondary"}`,title:"Grid View",children:e.jsx(D,{size:14})})]})]}),s&&e.jsx($,{rows:6,cols:6}),!s&&g.length>0&&(t==="org"?e.jsx(H,{agents:g,sessions:m,onSelectAgent:j}):e.jsx(X,{agents:g,onSelectAgent:j})),!s&&g.length===0&&e.jsx(G,{icon:I,title:"No agents found",subtitle:a?`No agents matching "${a}"`:"No agents in this team"}),N&&e.jsx(q,{agent:N,sessions:m,onClose:()=>j(null)})]})}export{te as default};
