import{j as e}from"./vendor-query-BDlgVFKC.js";import{r as x}from"./vendor-react-C3UgDDkQ.js";import{g as y,h as v,e as C,c as p,i as w,j as k}from"./index-BLPMiw5x.js";import{P as R}from"./PageHeader-DXQHnwq5.js";import{E as S}from"./EmptyState-BRa_Xz5S.js";import{C as T}from"./CopyButton-B9VrSSor.js";import{o as M,P as A,m as I,p as b,i as z,C as E,q as $,d as L,h as D}from"./vendor-icons-DvjlSrBB.js";import"./vendor-dates-DKd7Sy4i.js";function u({label:r,value:i,subValue:c,icon:s,color:o="text-text-primary"}){return e.jsxs("div",{className:"bg-surface border border-border-default rounded-lg px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(s,{size:14,className:"text-text-muted"}),e.jsx("span",{className:"text-caption text-text-muted uppercase tracking-wider",children:r})]}),e.jsx("div",{className:`text-xl font-bold font-data ${o}`,children:i}),c&&e.jsx("div",{className:"text-caption text-text-muted mt-0.5",children:c})]})}function O({jobId:r}){const{data:i=[],isLoading:c}=w(r,10);return c?e.jsx("div",{className:"px-4 py-3 text-xs text-text-muted",children:"Loading run history…"}):i.length===0?e.jsx("div",{className:"px-4 py-3 text-xs text-text-muted",children:"No run history available"}):e.jsxs("div",{className:"px-4 pb-3",children:[e.jsx("p",{className:"text-caption uppercase tracking-wider text-text-muted mb-2",children:"Recent Runs"}),e.jsx("div",{className:"space-y-1",children:i.map((s,o)=>e.jsxs("div",{className:"flex items-center gap-3 text-xs py-1.5 px-2 rounded hover:bg-elevated/50",children:[s.status==="ok"||s.action==="finished"?e.jsx(D,{size:12,className:"text-accent-green shrink-0"}):e.jsx(b,{size:12,className:"text-accent-red shrink-0"}),e.jsx("span",{className:"text-text-secondary w-32 shrink-0",children:s.runAtMs?p(new Date(s.runAtMs).toISOString()):p(s.runAt||s.startedAt)}),s.durationMs&&e.jsx("span",{className:"text-text-muted font-data w-16 shrink-0",children:k(s.durationMs/1e3)}),e.jsx("span",{className:`font-medium ${s.status==="ok"?"text-accent-green":s.status==="error"?"text-accent-red":"text-text-muted"}`,children:s.action||s.status||"—"}),s.summary&&e.jsx("span",{className:"text-text-muted truncate flex-1",title:s.summary,children:s.summary.slice(0,80)}),s.sessionId&&e.jsx(T,{text:s.sessionId,display:s.sessionId.slice(0,8)})]},s.id||s.runAtMs||s.runAt||o))})]})}function X(){const{data:r=[],isLoading:i,refetch:c}=y(),[s,o]=x.useState(""),[g,N]=x.useState(null),[m,j]=x.useState("all"),n=x.useMemo(()=>{const t=r.filter(l=>l.enabled),a=r.filter(l=>{if(!l.state?.lastRunAtMs)return!1;const f=new Date;return f.setHours(0,0,0,0),l.state.lastRunAtMs>=f.getTime()}),d=a.filter(l=>l.state?.lastResult==="error"||l.state?.lastResult==="fail");return{total:r.length,enabled:t.length,ranToday:a.length,failedToday:d.length}},[r]),h=x.useMemo(()=>{let t=r;if(m==="enabled"&&(t=t.filter(a=>a.enabled)),m==="disabled"&&(t=t.filter(a=>!a.enabled)),s.trim()){const a=s.toLowerCase();t=t.filter(d=>d.name.toLowerCase().includes(a)||(d.agentId||"").toLowerCase().includes(a))}return t},[r,m,s]);return i?e.jsx(v,{rows:8,cols:6}):e.jsxs("div",{className:"page-enter space-y-6",children:[e.jsx(R,{title:"Cron Operations",subtitle:`${r.length} cron jobs configured`,onRefresh:c}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(u,{label:"Total Crons",value:n.total,icon:M}),e.jsx(u,{label:"Enabled",value:n.enabled,subValue:`${n.total-n.enabled} disabled`,icon:A,color:"text-accent-green"}),e.jsx(u,{label:"Ran Today",value:n.ranToday,icon:I,color:"text-accent-blue"}),e.jsx(u,{label:"Failed Today",value:n.failedToday,icon:b,color:n.failedToday>0?"text-accent-red":"text-text-muted"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(z,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"}),e.jsx("input",{type:"text",value:s,onChange:t=>o(t.target.value),placeholder:"Search cron jobs...",className:"w-full pl-9 pr-3 py-2 bg-surface border border-border-default rounded-md text-sm text-text-primary placeholder:text-text-muted focus:outline-none focus:border-accent-blue transition-colors","aria-label":"Search cron jobs"})]}),e.jsx("div",{className:"flex items-center gap-1 bg-surface border border-border-default rounded-md p-0.5",children:["all","enabled","disabled"].map(t=>e.jsx("button",{type:"button",onClick:()=>j(t),className:`px-2.5 py-1.5 rounded text-xs font-medium transition-colors ${m===t?"bg-accent-blue/10 text-accent-blue":"text-text-muted hover:text-text-secondary"}`,children:t==="all"?"All":t},t))})]}),h.length===0?e.jsx(S,{icon:E,title:"No cron jobs found",subtitle:s?`No results for "${s}"`:"No cron jobs configured"}):e.jsxs("div",{className:"bg-surface border border-border-default rounded-lg overflow-hidden",children:[e.jsx("div",{className:"divide-y divide-border-default",children:h.map(t=>{const a=g===t.id,d=t.state?.lastRunAtMs?new Date(t.state.lastRunAtMs).toISOString():null,l=t.state?.nextRunAtMs?new Date(t.state.nextRunAtMs).toISOString():null;return e.jsxs("div",{children:[e.jsxs("button",{type:"button",className:"w-full flex items-center gap-4 px-4 py-3 hover:bg-elevated/50 transition-colors text-left",onClick:()=>N(a?null:t.id),children:[a?e.jsx($,{size:14,className:"text-text-muted shrink-0"}):e.jsx(L,{size:14,className:"text-text-muted shrink-0"}),e.jsx("div",{className:`w-2 h-2 rounded-full shrink-0 ${t.enabled?"bg-accent-green":"bg-gray-600"}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-text-primary truncate",children:t.name}),e.jsx("p",{className:"text-caption text-text-muted",children:t.agentId||"default"})]}),e.jsxs("div",{className:"text-right shrink-0",children:[e.jsx("p",{className:"text-xs text-text-secondary font-data",children:C(t.schedule?.expr)}),e.jsxs("p",{className:"text-caption text-text-muted",children:[t.schedule?.expr,t.schedule?.tz?` · ${t.schedule.tz}`:""]})]}),e.jsxs("div",{className:"text-right shrink-0 w-24",children:[e.jsx("p",{className:"text-caption text-text-muted",children:"Last run"}),e.jsx("p",{className:"text-xs text-text-secondary",children:d?p(d):"—"})]}),e.jsxs("div",{className:"text-right shrink-0 w-24",children:[e.jsx("p",{className:"text-caption text-text-muted",children:"Next run"}),e.jsx("p",{className:"text-xs text-text-secondary",children:l?p(l):"—"})]})]}),a&&e.jsx("div",{className:"border-t border-border-default bg-elevated/30",children:e.jsx(O,{jobId:t.id})})]},t.id)})}),e.jsx("div",{className:"border-t border-border-default px-4 py-2",children:e.jsxs("span",{className:"text-xs text-text-muted",children:[h.length," of ",r.length," cron jobs"]})})]})]})}export{X as default};
