import{j as e}from"./vendor-query-BDlgVFKC.js";import{y as g,z as p,S as h,B as j,c as f,j as b}from"./index-BLPMiw5x.js";import{P as x}from"./PageHeader-DXQHnwq5.js";import{C as d,B as o}from"./Badge-9NDiIoki.js";import"./MetricCard-Dry5Bpqx.js";import"./StatusBadge-x29XDuZr.js";import{E as N}from"./EmptyState-BRa_Xz5S.js";import"./vendor-react-C3UgDDkQ.js";import{v,e as m,w as y,f as w,x as S,W as k}from"./vendor-icons-DvjlSrBB.js";import"./vendor-dates-DKd7Sy4i.js";function A({health:t}){return t?(t.ts&&b((Date.now()-(t.ts-(t.durationMs||0)))/1e3),e.jsxs(d,{padding:"none",overflow:!0,children:[e.jsxs("div",{className:"flex items-center gap-3 px-5 py-4 border-b border-border-default",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${t.ok?"bg-accent-green/10":"bg-accent-red/10"}`,children:e.jsx(S,{size:20,className:t.ok?"text-accent-green":"text-accent-red"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-sm font-semibold text-text-primary",children:"Gateway"}),e.jsx("p",{className:"text-xs text-text-muted",children:t.ok?"Healthy":"Unhealthy"})]}),e.jsx(o,{color:t.ok?"green":"red",size:"md",children:t.ok?"Online":"Offline"})]}),e.jsxs("div",{className:"px-5 py-4 grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-caption text-text-muted uppercase tracking-wider mb-0.5",children:"Default Agent"}),e.jsx("div",{className:"text-sm text-text-primary font-data",children:t.defaultAgentId||"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-caption text-text-muted uppercase tracking-wider mb-0.5",children:"Heartbeat"}),e.jsx("div",{className:"text-sm text-text-primary font-data",children:t.heartbeatSeconds?`${t.heartbeatSeconds}s`:"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-caption text-text-muted uppercase tracking-wider mb-0.5",children:"Agents"}),e.jsx("div",{className:"text-sm text-text-primary font-data",children:t.agents?.length||0})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-caption text-text-muted uppercase tracking-wider mb-0.5",children:"Probe Time"}),e.jsx("div",{className:"text-sm text-text-primary font-data",children:t.durationMs?`${t.durationMs}ms`:"—"})]})]})]})):null}function $({id:t,label:a,channel:s}){const n=s?.running===!0,i=s?.configured===!0;return e.jsxs("div",{className:`bg-surface border rounded-lg p-4 transition-colors ${n?"border-accent-green/30":"border-border-default"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${n?"bg-accent-green/10":"bg-elevated"}`,children:n?e.jsx(k,{size:16,className:"text-accent-green"}):e.jsx(m,{size:16,className:"text-text-muted"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-text-primary capitalize",children:a||t}),e.jsx("p",{className:"text-caption text-text-muted",children:n?`Running (${s.mode||"active"})`:i?"Configured but not running":"Not configured"})]}),e.jsx("span",{className:`w-2.5 h-2.5 rounded-full ${n?"bg-accent-green animate-pulse-green":i?"bg-accent-yellow":"bg-gray-600"}`})]}),e.jsxs("div",{className:"space-y-1.5 text-xs",children:[s?.tokenSource&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-text-muted",children:"Token source"}),e.jsx("span",{className:"text-text-secondary font-data",children:s.tokenSource})]}),s?.mode&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-text-muted",children:"Mode"}),e.jsx("span",{className:"text-text-secondary font-data",children:s.mode})]}),s?.lastStartAt&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-text-muted",children:"Started"}),e.jsx("span",{className:"text-text-secondary font-data",children:new Date(s.lastStartAt).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),s?.lastError&&e.jsx("div",{className:"mt-2 px-2 py-1.5 bg-accent-red/5 border border-accent-red/20 rounded text-accent-red text-caption",children:s.lastError})]})]})}function H({agent:t}){const a=t.sessions?.count||0,s=t.heartbeat?.enabled,n=t.sessions?.recent?.[0];return e.jsxs("div",{className:"flex items-center gap-3 px-4 py-2.5 hover:bg-elevated/50 transition-colors",children:[e.jsx("span",{className:`w-2 h-2 rounded-full shrink-0 ${a>0?"bg-accent-green":"bg-gray-600"}`}),e.jsx("span",{className:"text-sm text-text-primary flex-1 truncate",children:t.name||t.agentId}),e.jsxs("span",{className:"text-xs text-text-muted font-data w-12 text-right",children:[a," sess"]}),s&&e.jsx(o,{color:"blue",shape:"tag",children:t.heartbeat.every}),n&&e.jsx("span",{className:"text-xs text-text-muted font-data w-20 text-right",children:n.age<6e4?"now":n.age<36e5?`${Math.round(n.age/6e4)}m ago`:`${Math.round(n.age/36e5)}h ago`})]})}function C(){const{data:t}=j();return!t||t.length===0?null:e.jsxs(d,{padding:"none",overflow:!0,children:[e.jsxs("div",{className:"px-4 py-3 border-b border-border-default flex items-center gap-2",children:[e.jsx(w,{size:14,className:"text-accent-red"}),e.jsx("h2",{className:"text-sm font-semibold text-text-primary",children:"Active Alerts"}),e.jsx("span",{className:"text-xs text-accent-red font-data ml-auto",children:t.length})]}),e.jsx("div",{className:"divide-y divide-border-default",children:t.map(a=>e.jsxs("div",{className:`flex items-center gap-3 px-4 py-3 ${a.severity==="critical"?"bg-accent-red/5":"bg-yellow-500/5"}`,children:[e.jsx("span",{className:`w-2 h-2 rounded-full shrink-0 ${a.severity==="critical"?"bg-accent-red animate-pulse":"bg-yellow-500"}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-text-primary font-medium",children:a.title}),a.message&&e.jsx("p",{className:"text-xs text-text-muted mt-0.5",children:a.message})]}),e.jsx("span",{className:"text-caption text-text-muted shrink-0",children:f(a.ts)})]},a.id))})]})}function P(){const{data:t,isLoading:a,refetch:s}=g(),{data:n,isLoading:i}=p();if(a||i)return e.jsxs("div",{className:"space-y-4",children:[e.jsx(x,{title:"System Health",subtitle:"Loading…"}),e.jsx(h,{})]});const l=n?.channels||{},u=n?.channelLabels||{};return e.jsxs("div",{className:"page-enter space-y-6",children:[e.jsx(x,{title:"System Health",subtitle:"Gateway, channels, and agent connectivity",onRefresh:s}),e.jsx(C,{}),e.jsx(A,{health:t}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-sm font-semibold text-text-primary mb-3 flex items-center gap-2",children:[e.jsx(v,{size:14,className:"text-text-muted"})," Channels"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(l).length===0?e.jsx(N,{icon:m,title:"No channels configured",subtitle:"Add channels via openclaw channels add"}):Object.entries(l).map(([r,c])=>e.jsx($,{id:r,label:u[r]||r,channel:c},r))})]}),t?.agents&&t.agents.length>0&&e.jsxs(d,{padding:"none",overflow:!0,children:[e.jsx(d.Header,{title:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(y,{size:14,className:"text-text-muted"})," Agent Fleet Health"]}),subtitle:`${t.agents.length} agents`}),e.jsx("div",{className:"divide-y divide-border-default max-h-96 overflow-y-auto",children:t.agents.sort((r,c)=>(c.sessions?.count||0)-(r.sessions?.count||0)).map(r=>e.jsx(H,{agent:r},r.agentId))})]})]})}export{P as default};
